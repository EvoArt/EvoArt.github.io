<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Arthur Newbury - 2. How to Construct a Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Books</li><li class="breadcrumb-item"><a href="../otto_day/index.html">Otto and Day</a></li><li class="breadcrumb-item"><a href="../otto_day/otto_day_02.html">2. How to Construct a Model</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Arthur Newbury</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Education Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Games</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../games/resistance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resistance</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Books</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Otto and Day</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../otto_day/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../otto_day/otto_day_01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Mathematical Modelling in Biology</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../otto_day/otto_day_02.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2. How to Construct a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../otto_day/otto_day_03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Deriving Classical Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../otto_day/otto_day_p1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Primer 1. Functions and Approximations</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#diagrams" id="toc-diagrams" class="nav-link active" data-scroll-target="#diagrams">Diagrams</a>
  <ul class="collapse">
  <li><a href="#life-cycle-diagrams" id="toc-life-cycle-diagrams" class="nav-link" data-scroll-target="#life-cycle-diagrams">Life cycle diagrams</a></li>
  <li><a href="#flow-diagrams" id="toc-flow-diagrams" class="nav-link" data-scroll-target="#flow-diagrams">Flow diagrams</a></li>
  </ul></li>
  <li><a href="#dynamical-models" id="toc-dynamical-models" class="nav-link" data-scroll-target="#dynamical-models">Dynamical models</a>
  <ul class="collapse">
  <li><a href="#discrete-time-recursion-equations" id="toc-discrete-time-recursion-equations" class="nav-link" data-scroll-target="#discrete-time-recursion-equations">Discrete-time Recursion Equations</a></li>
  <li><a href="#continuous-time-differential-equations" id="toc-continuous-time-differential-equations" class="nav-link" data-scroll-target="#continuous-time-differential-equations">Continuous-time Differential Equations</a>
  <ul class="collapse">
  <li><a href="#differential-equations-from-numerical-functions" id="toc-differential-equations-from-numerical-functions" class="nav-link" data-scroll-target="#differential-equations-from-numerical-functions">Differential Equations from Numerical Functions</a></li>
  <li><a href="#differential-equations-from-symbolic-expressions" id="toc-differential-equations-from-symbolic-expressions" class="nav-link" data-scroll-target="#differential-equations-from-symbolic-expressions">Differential Equations from Symbolic Expressions</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2. How to Construct a Model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="diagrams" class="level1 page-columns page-full">
<h1>Diagrams</h1>
<p>One of the take-homes of this chapter is the importance of drawing a diagram of your mental model, before it becomes a mathematical model. The easiest way to draw a simple diagram is with pen/pencil and paper, but it’s useful to know how to produce flow diagrams and life cycles like the ones in the book with your computer. This is important for inclusion in publications, presentations theses etc., but also if you just tend to keep digital notes and/or want to produce diagrams programmatically such that they will automatically update as you adjust your model. To this end I will use Tikz, which is a drawing library written in/for LaTeX. Since Tikz is code based, there is a bit of a learning curve, and you may be served better by using a free drawing tool like Inkscape if building diagrams programmatically is not particularly desirable to you. However, for building reproducible documents like this one, code is king. And if you wish to produce PDF documents, writing your diagrams directly in LaTeX has significant advantages. Thankfully, there is an interface to Tikz from Julia via the package <code>TikzPictures</code>. So let’s use it to recreate the Figure 2.2b: the lifecycle diagram of the effect of a cat on the number of mice in a yard.</p>
<section id="life-cycle-diagrams" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="life-cycle-diagrams">Life cycle diagrams</h2>
<p>First, we need to draw a circle. We are going to define a variable called <code>Radius</code> to make it easier to locate certain positions on the circle where we want to place arrows. Then draw a thick lined circle of the specified radius, centred at location <code>(0,0)</code>.</p>
<div class="cell page-columns page-full" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">TikzPictures</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \def\Radius{2cm}</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [ultra thick] (0cm,0cm) circle[radius=\Radius];</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="2">
<p><img src="otto_day_02_files/figure-html/cell-2-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>The L followed by 3 quotation marks means we are using a <code>LaTeX String</code>, this basically means we can write LaTeX code in Julia without worrying about <code>\</code> string escapes etc. Next, we want to place an arrow on the right hand side of the circle. <code>\draw[-latex]</code> means we are drawing a line with and arrow at the <strong>end of the line</strong> (“latex” is the name of a specific type of arrowhead). Since the circle is centred at (0,0), the right hand side is at x,y coordinates <code>(\Radius, 0)</code>, and because we want our arrow pointing along the direction of the circle, we want our line to be in an arc with radius <code>Radius</code>. Since it is conventional in maths to consider points on a circle starting from the far right and going around anti-clockwise, we will arc around from 3 to - 3.</p>
<div class="cell page-columns page-full" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">  \def\Radius{2cm}</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [ultra thick] (0cm,0cm) circle[radius=\Radius];</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[-latex] (\Radius, 0) arc(3:-3:\Radius);</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="3">
<p><img src="otto_day_02_files/figure-html/cell-3-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>Oh dear, the arrow head is too small to make out against our <code>ultra thick</code> circle. Now in order to tweak the appearance of the arrow head we will use a library (bundled with Tikz) called <code>arrows.meta</code> which provides it’s own arrow head styles (typically the same names as base Tikz but with a capital first letter).</p>
<div class="cell page-columns page-full" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">  \def\Radius{2cm}</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [ultra thick] (0cm,0cm) circle[radius=\Radius];</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[-{Latex[length=0.4cm, width=0.2cm]}] (\Radius, 0) arc(3:-3:\Radius);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usetikzlibrary{arrows.meta}"</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="4">
<p><img src="otto_day_02_files/figure-html/cell-4-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>Now we can add a <code>node</code> slightly above and to the left of the end of the arrow. Nodes are very important in Tikz. They can be used directly as labels, but they also define a specific spatial location which can be used as an anchor, allowing additional nodes and drawings to be defined relative to them. Here we place <span class="math inline">\(n''\)</span> at our node location.</p>
<div class="cell page-columns page-full" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">  \def\Radius{2cm}</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [ultra thick] (0cm,0cm) circle[radius=\Radius];</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[-{Latex[length=0.4cm, width=0.2cm]}] (\Radius, 0) arc(3:-3:\Radius) node[above left]{</span><span class="sc">$</span>n<span class="st">'</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">""", </span>preamble<span class="st"> = "</span><span class="sc">\\</span><span class="st">usetikzlibrary{arrows.meta}"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="5">
<p><img src="otto_day_02_files/figure-html/cell-5-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>Additionally, we specify a label with an <code>xshift</code> and <code>yshift</code> (determined through trial and error).</p>
<div class="cell page-columns page-full" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">  \def\Radius{2cm}</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [ultra thick] (0cm,0cm) circle[radius=\Radius];</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[-{Latex[length=0.4cm, width=0.2cm]}] (\Radius, 0) arc(3:-3:\Radius) node[above left, label={[xshift=1.2cm, yshift=0.2cm]Predation}]{</span><span class="sc">$</span>n<span class="st">'</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">""", </span>preamble<span class="st"> = "</span><span class="sc">\\</span><span class="st">usetikzlibrary{arrows.meta}"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="6">
<p><img src="otto_day_02_files/figure-html/cell-6-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>And then do the same for each arrow and voila…</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="st">  \def\Radius{2cm}</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [ultra thick] (0cm,0cm) circle[radius=\Radius];</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[-{Latex[length=0.4cm, width=0.2cm]}] (\Radius, 0) arc(3:-3:\Radius) node[above left, label={[xshift=1.2cm, yshift=0.2cm]Predation}]{</span><span class="sc">$</span>n<span class="st">'</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="st">    \</span>draw<span class="st">[-{Latex[length=0.4cm, width=0.2cm]}] (0, \Radius) arc(90+3:90-3:\Radius) node[below, label={[xshift= -1.2cm]Census}]{</span><span class="sc">$</span>n<span class="sc">$</span><span class="st">};</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="st">    \</span>draw<span class="st">[-{Latex[length=0.4cm, width=0.2cm]}] (-\Radius, 0) arc(180+3:180-3:\Radius) node[right, label={[xshift= -1.2cm, yshift = -1.0cm]Migration}]{</span><span class="sc">$</span>n<span class="st">'''</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="st">    \</span>draw<span class="st">[-{Latex[length=0.4cm, width=0.2cm]}] (0,-\Radius) arc(270+3:270-3:\Radius) node[above right, label={[xshift= 1.0cm, yshift = -0.85cm]Births}]{</span><span class="sc">$</span>n<span class="st">''</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="st">""", </span>preamble<span class="st"> = "</span><span class="sc">\\</span><span class="st">usetikzlibrary{arrows.meta}"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<p><img src="otto_day_02_files/figure-html/cell-7-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
<section id="flow-diagrams" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="flow-diagrams">Flow diagrams</h2>
<p>Let’s take a stab at the flow diagaram associated with the same model (Fig. 2.4b). For this it will be good to use the <code>positioning</code> library, and we’ll get more of a sense of using nodes as connecting points. In particular, we will start by making a circle node and naming it <span class="math inline">\(n\)</span>, then making a completely empty node called <span class="math inline">\(neighbours\)</span>. This empty node represents neighbouring areas from which other mice may migrate. rather than giving it’s location by x, y coordinates, we will specify it’s location <em>relative</em> to <span class="math inline">\(n\)</span>. Then, we can draw an arrow from one node to the other. For simplicity, we won’t mess around with arrow heads hear, and just use the default one.</p>
<div class="cell page-columns page-full" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (n)[thick, circle, align = center, draw = black] at (0,0) { Number of </span><span class="sc">\\</span><span class="st"> mice </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>n<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>node<span class="st">[left = of n] (neighbours){};</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[thick, -&gt;] (neighbours) -- (n);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usetikzlibrary{positioning}"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="8">
<p><img src="otto_day_02_files/figure-html/cell-8-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>Okay, that’s step one. But this arrow coming in is pretty meaningless without a label. We can do this by adding a node along the path from neighbours to <span class="math inline">\(n\)</span>.</p>
<div class="cell page-columns page-full" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (n)[thick, circle, align = center, draw = black] at (0,0) { Number of </span><span class="sc">\\</span><span class="st"> mice </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>n<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>node<span class="st">[left = of n] (neighbours){};</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[thick, -&gt;] (neighbours) -- (n);</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">    \draw[thick, -&gt;] (neighbours) -- node[above]{</span><span class="sc">$</span>m<span class="sc">$</span><span class="st">} ++ </span>(n)<span class="st">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usetikzlibrary{positioning}"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="9">
<p><img src="otto_day_02_files/figure-html/cell-9-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>Alright, that’s migration sorted. Now we can do the same for predation. I’ll use a skull from the <code>skull</code> library, though it doesn’t look nearly as good as the one from the book. I’ll also specify that the label should be sloped i.e., it will follow the angle of the path from <span class="math inline">\(n\)</span> to the skull. They don’t do this in the book, but it’s a nice feature to demonstrate.</p>
<div class="cell page-columns page-full" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (n)[thick, circle, align = center, draw = black] at (0,0) { Number of </span><span class="sc">\\</span><span class="st"> mice </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>n<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>node<span class="st">[left = of n] (neighbours){};</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode[below right = of n] (d) {</span><span class="sc">$</span><span class="st">\</span>skull<span class="sc">$</span><span class="st">};</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>draw<span class="st">[thick, -&gt;] (neighbours) -- node[above]{</span><span class="sc">$</span>m<span class="sc">$</span><span class="st">} ++ </span>(n)<span class="st">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw[thick, -&gt;] (n) -- node[sloped,above]{</span><span class="sc">$</span>d<span class="st"> \, n(t)</span><span class="sc">$</span><span class="st">} ++ </span>(d)<span class="st">;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usepackage{skull} </span><span class="sc">\n</span><span class="st">  </span><span class="sc">\\</span><span class="st">usetikzlibrary{positioning}"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="10">
<p><img src="otto_day_02_files/figure-html/cell-10-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>Finally, the loop from <span class="math inline">\(n\)</span> back to itself, representing births</p>
<div class="cell page-columns page-full" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (n)[thick, circle, align = center, draw = black] at (0,0) { Number of </span><span class="sc">\\</span><span class="st"> mice </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>n<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>node<span class="st">[left = of n] (neighbours){};</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode[below right = of n] (d) {</span><span class="sc">$</span><span class="st">\</span>skull<span class="sc">$</span><span class="st">};</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>draw<span class="st">[thick, -&gt;] (neighbours) -- node[above]{</span><span class="sc">$</span>m<span class="sc">$</span><span class="st">} ++ </span>(n)<span class="st">;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw[thick, -&gt;] (n) -- node[sloped,above]{</span><span class="sc">$</span>d<span class="st"> \, n(t)</span><span class="sc">$</span><span class="st">} ++ </span>(d)<span class="st">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">  \path [thick, -&gt;] (n) edge [loop above]  node[above] {</span><span class="sc">$</span>b<span class="st"> \, n'(t)</span><span class="sc">$</span><span class="st">} </span>(n)<span class="st">;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usepackage{skull} </span><span class="sc">\n</span><span class="st">  </span><span class="sc">\\</span><span class="st">usetikzlibrary{positioning}"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="11">
<p><img src="otto_day_02_files/figure-html/cell-11-output-1.svg" class="img-fluid"></p>
</div></div></div>
<p>We can fine tune the positioning of the loop to try and match the book. Again, we work with degrees anti-clockwise from the right hand side.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Julia</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">LaTeX</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (n)[thick, circle, align = center, draw = black] at (0,0) { Number of </span><span class="sc">\\</span><span class="st"> mice </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>n<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>node<span class="st">[left = of n] (neighbours){};</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode[below right = of n] (d) {</span><span class="sc">$</span><span class="st">\</span>skull<span class="sc">$</span><span class="st">};</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>draw<span class="st">[thick, -&gt;] (neighbours) -- node[above]{</span><span class="sc">$</span>m<span class="sc">$</span><span class="st">} ++ </span>(n)<span class="st">;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw[thick, -&gt;] (n) -- node[sloped,above]{</span><span class="sc">$</span>d<span class="st"> \, n(t)</span><span class="sc">$</span><span class="st">} ++ </span>(d)<span class="st">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="st">  \draw [thick, -&gt;] (n) edge [out=60,in=30,looseness=4] node[below right,label={[xshift=0.4cm, yshift=-0.9cm]</span><span class="sc">$</span>b<span class="st"> \, n'(t)</span><span class="sc">$</span><span class="st">}] {} </span>(n)<span class="st">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usepackage{skull} </span><span class="sc">\n</span><span class="st">  </span><span class="sc">\\</span><span class="st">usetikzlibrary{positioning}"</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb12"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">\documentclass</span>{<span class="ex">standalone</span>}</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">\usepackage</span>{<span class="ex">skull</span>}</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">\usepackage</span>{<span class="ex">tikz</span>}</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{positioning}</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">document</span>}</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (n)[thick, circle, align = center, draw = black] at (0,0) { Number of <span class="fu">\\</span> mice <span class="fu">\\</span> <span class="ss">$n(t)$</span>};</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span>[left = of n] (neighbours){};</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span>[below right = of n] (d) {<span class="ss">$</span><span class="sc">\skull</span><span class="ss">$</span>};</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\draw</span>[thick, -&gt;] (neighbours) -- node[above]{<span class="ss">$m$</span>} ++ (n);</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\draw</span>[thick, -&gt;] (n) -- node[sloped,above]{<span class="ss">$d </span><span class="sc">\,</span><span class="ss"> n(t)$</span>} ++ (d);</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\draw</span> [thick, -&gt;] (n) edge [out=60,in=30,looseness=4] node[below right,label={[xshift=0.4cm, yshift=-0.9cm]<span class="ss">$b </span><span class="sc">\,</span><span class="ss"> n'(t)$</span>}] {} (n);</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">document</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="cell-output cell-output-display" data-execution_count="12">
<p><img src="otto_day_02_files/figure-html/cell-12-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Below we can see how to draw the curved dashed line seen in the flow diagram of the flu model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Julia</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">LaTeX</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="sourceCode" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TikzPicture</span>(L<span class="st">"""</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (s)[thick, circle, minimum size=2.4cm, align = center, draw = black] at (0,0) {People </span><span class="sc">\\</span><span class="st"> without flu </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>s<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>node<span class="st"> (midway)[label={[xshift= 1.0cm, yshift=-0.8cm]</span><span class="sc">$</span>a<span class="st"> \, c \, s(t) \, n(t)</span><span class="sc">$</span><span class="st">}] </span>at<span class="st"> (2.5cm,0cm) {};</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">  </span><span class="sc">\n</span><span class="st">ode (n)[ thick, circle, minimum size=2.4cm, align = center, draw = black] at (6cm,0cm) {People </span><span class="sc">\\</span><span class="st"> with flu </span><span class="sc">\\</span><span class="st"> </span><span class="sc">$</span>n<span class="st">(t)</span><span class="sc">$</span><span class="st">};</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">  \</span>draw<span class="st">[thick, -&gt;] (s) --  (n);</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">  \path [-&gt;,draw,thick, dashed] (n) to[out=90,in=150, distance=2cm] (midway);</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, preamble <span class="op">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">usetikzlibrary{positioning}"</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="sourceCode" id="cb14"><pre class="sourceCode latex code-with-copy"><code class="sourceCode latex"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">\documentclass</span>{<span class="ex">standalone</span>}</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">\usepackage</span>{<span class="ex">tikz</span>}</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{positioning}</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">document</span>}</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (s)[thick, circle, minimum size=2.4cm, align = center, draw = black] at (0,0) {People <span class="fu">\\</span> without flu <span class="fu">\\</span> <span class="ss">$s(t)$</span>};</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (midway)[label={[xshift= 1.0cm, yshift=-0.8cm]<span class="ss">$a </span><span class="sc">\,</span><span class="ss"> c </span><span class="sc">\,</span><span class="ss"> s(t) </span><span class="sc">\,</span><span class="ss"> n(t)$</span>}] at (2.5cm,0cm) {};</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\node</span> (n)[ thick, circle, minimum size=2.4cm, align = center, draw = black] at (6cm,0cm) {People <span class="fu">\\</span> with flu <span class="fu">\\</span> <span class="ss">$n(t)$</span>};</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\draw</span>[thick, -&gt;] (s) --  (n);</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">\path</span> [-&gt;,draw,thick, dashed] (n) to[out=90,in=150, distance=2cm] (midway);</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">document</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="cell-output cell-output-display" data-execution_count="13">
<p><img src="otto_day_02_files/figure-html/cell-13-output-1.svg" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="dynamical-models" class="level1 page-columns page-full">
<h1>Dynamical models</h1>
<p>Taking the mouse population dynamics example from the book, we will take a look at how you might derive and solve both recursion and differential equations, without having to do any of the maths by hand. We will manipulate symbolic equations using <a href="https://docs.sciml.ai/Symbolics/stable/"><code>Symbolics</code></a>, numerically solve differential equations using <a href="https://docs.sciml.ai/DiffEqDocs/stable/"><code>DifferentialEquations</code></a> and do a bit of both with <a href="https://docs.sciml.ai/ModelingToolkit/stable/"><code>ModelingToolkit</code></a>. All three packages are developed and maintained by the <a href="https://docs.sciml.ai/Overview/stable/">SciML (Scientific Machine Learning) organisation</a>.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Symbolics</span>, <span class="bu">CairoMakie</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Symbolics</code> has a long way to go, to catch up with SymPy (which is itself no match for Mathematica) in terms of available features. Thus, it’s definitely not the best choice for a purely symbolic workflow. However, if you need to mix in a some basic symbolic programming alongside your numerical work, it is very handy. In particular, we will see two different ways to build solvable differential equation problems from symbolic expressions.</p>
<section id="discrete-time-recursion-equations" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="discrete-time-recursion-equations">Discrete-time Recursion Equations</h2>
<p>Here, we will use the <code>Symbolis</code>’s <code>@variables</code> macro to define some symbolic variables to work with.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@variables</span> b d m t nₜ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<p><span class="math display">\[ \begin{equation}
\left[
\begin{array}{c}
b \\
d \\
m \\
t \\
n_t \\
\end{array}
\right]
\end{equation}
\]</span></p>
</div>
</div>
<p>Plugging in the equations for births, deaths and migration, we arrive at our recursion equation.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>n′ <span class="op">=</span> <span class="fu">nₜ*</span>(<span class="fl">1</span><span class="op">+</span>b)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>n′′ <span class="op">=</span> <span class="fu">n′*</span>(<span class="fl">1</span><span class="op">-</span>d)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>n′′′ <span class="op">=</span> n′′<span class="op">+</span>m</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>nₜ₊₁ <span class="op">=</span> n′′′</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<p><span class="math display">\[ \begin{equation}
m + n_t \left( 1 + b \right) \left( 1 - d \right)
\end{equation}
\]</span></p>
</div>
</div>
<p>Now we can use the <code>build_function</code> erm function, to build a function that takes in <span class="math inline">\(n(t)\)</span> and our parameter values, and returns <span class="math inline">\(n(t+1)\)</span>. To do this we call <code>build_function</code> on the expression we want to turn into a function, followed by the arguments we will be passing to our built function, in order. This generates some code. But we need to <code>eval</code>uate the code, in order to make a callable function.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>recursion <span class="op">=</span> <span class="fu">eval</span>(<span class="fu">build_function</span>(nₜ₊₁, b, d, m, nₜ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we want to find the solution over some given time span, for particular parameter values. There are methods for <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/discrete_types/">solving recursion and difference equations</a> included in <code>DifferentialEquations</code>, but for this simple case we can just use a loop.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mice_recursion</span>(b, d, m, nₜ, t_max)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    n_step <span class="op">=</span> t_max <span class="op">+</span> <span class="fl">1</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>,n_step)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    res[<span class="fl">1</span>] <span class="op">=</span> nₜ</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>n_step</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        res[step] <span class="op">=</span> <span class="fu">recursion</span>(b, d, m, res[step <span class="op">-</span> <span class="fl">1</span>])</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    res</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s assume there are no mice at the start, but migration is high and the death rate is slightly above the birth rate.</p>
<div class="cell page-columns page-full" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig,ax,rec_plt <span class="op">=</span> <span class="fu">lines</span>(<span class="fu">mice_recursion</span>(<span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">0.0</span>, <span class="fl">100</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ax.ylabel <span class="op">=</span> L<span class="st">"No. mice </span><span class="sc">$</span>n<span class="sc">$</span><span class="st">"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ax<span class="st">.xlabel = L"</span>t<span class="st">"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="19">
<p><img src="otto_day_02_files/figure-html/cell-19-output-1.svg" class="img-fluid"></p>
</div></div></div>
</section>
<section id="continuous-time-differential-equations" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="continuous-time-differential-equations">Continuous-time Differential Equations</h2>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DifferentialEquations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Following Box 2.6 from the book, we can derive a differential equation by finding the change in <span class="math inline">\(n\)</span> over the time period <span class="math inline">\(\Delta t\)</span> in the limit as <span class="math inline">\(\Delta\)</span> goes to zero. First, we express the dynamics explicitly including <span class="math inline">\(\Delta t\)</span>, the time change over a single time-step.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@variables</span>  Δt</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>n′ <span class="op">=</span> <span class="fu">nₜ*</span>(<span class="fl">1</span><span class="op">+</span>b<span class="op">*</span>Δt)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>n′′ <span class="op">=</span> <span class="fu">n′*</span>(<span class="fl">1</span><span class="op">-</span>d<span class="op">*</span>Δt)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>n′′′ <span class="op">=</span> n′′<span class="op">+</span>m<span class="op">*</span>Δt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<p><span class="math display">\[ \begin{equation}
m {\Delta}t + n_t \left( 1 + b {\Delta}t \right) \left( 1 - d {\Delta}t \right)
\end{equation}
\]</span></p>
</div>
</div>
<p>Then we use the definition of a derivative (equation 2.6.2 from the book) to convert the recursion into a differential equation</p>
<p><span class="math display">\[
\frac{dn(t)}{dt} \equiv \text{lim}_{\Delta t \rightarrow 0}\left[\frac{n(t + \Delta t) - n(t)}{\Delta t} \right]
\]</span></p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>eq <span class="op">=</span> (n′′′ <span class="op">-</span> nₜ)<span class="op">/</span>Δt </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<p><span class="math display">\[ \begin{equation}
\frac{ - n_t + m {\Delta}t + n_t \left( 1 + b {\Delta}t \right) \left( 1 - d {\Delta}t \right)}{{\Delta}t}
\end{equation}
\]</span></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>simp_eq <span class="op">=</span> <span class="fu">simplify</span>(eq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<p><span class="math display">\[ \begin{equation}
m + b n_t - d n_t - b d n_t {\Delta}t
\end{equation}
\]</span></p>
</div>
</div>
<p>After simplifying, there re no divisions by <span class="math inline">\(\Delta t\)</span>. So we can proceed by setting <span class="math inline">\(\Delta t = 0\)</span>.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>diff_eq <span class="op">=</span> <span class="fu">substitute</span>(simp_eq, Δt <span class="op">=&gt;</span> <span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<p><span class="math display">\[ \begin{equation}
m + b n_t - d n_t
\end{equation}
\]</span></p>
</div>
</div>
<p>Again, we will build a numerical function from the symbolic expression.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>diff_eq_func <span class="op">=</span> <span class="fu">eval</span>(<span class="fu">build_function</span>(diff_eq, b, d, m, nₜ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="differential-equations-from-numerical-functions" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="differential-equations-from-numerical-functions">Differential Equations from Numerical Functions</h3>
<div class="page-columns page-full"><p>Using the <code>DifferentialEquations</code> package, we set up an ODE function which accepts 4 arguments for which the canonical names are <code>du</code> (a vector, containing the current trajectories of all variables), <code>u</code> ( the current values of all variables), <code>p</code> (the parameters), <code>t</code> (the current time). I will tend to use capital <code>P</code> in place of <code>p</code>, since we often use a lower-case p for frequency based variables.  Within the body of the function, we assign new values to each element in <code>du</code> according to our governing equations. Here, since we already have a function <code>diff_eq_func</code> which determines the dynamics of the mouse population, I will just use that directly within the ODE function. To pass in the parameter values we will use the <code>...</code> “splat” notation, which passes in each element of <code>P</code> as an individua argument, rather than as a single vector of parameters.</p><div class="no-row-height column-margin column-container"><span class="">Specifically, this is the <em>in-place</em> functional form <code>f(du, u, p, t)</code> as opposed to *out-of-place <code>f(u, p, t)</code>. In the latter case <code>f</code> would return <code>du</code> rather than modify it.</span></div></div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">mice</span>(du, u, P, t)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    du[<span class="fl">1</span>] <span class="op">=</span> <span class="fu">diff_eq_func</span>(P<span class="op">...</span>, u[<span class="fl">1</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So in order to solve the ODE we need to create an <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/#SciMLBase.ODEProblem"><code>ODEProblem</code></a> for our given function, starting values for variables (<code>u0</code>), time span, and parameter values.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>u₀ <span class="op">=</span> [<span class="fl">0.0</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>t_span <span class="op">=</span> (<span class="fl">0.0</span>,<span class="fl">100.0</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [<span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> <span class="fu">ODEProblem</span>(mice, u₀, t_span, P)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">ODEProblem</span> with uType <span class="ansi-cyan-fg">Vector{Float64}</span> and tType <span class="ansi-cyan-fg">Float64</span>. In-place: <span class="ansi-cyan-fg">true</span>
timespan: (0.0, 100.0)
u0: 1-element Vector{Float64}:
 0.0</pre>
</div>
</div>
</div>
<p>There is a plotting <em>recipe</em> for differential equation solutions provided by the the popular plotting package <code>Plots</code>, which allows you to get a plot by calling <code>plot(sol)</code>. Here we will use <code>Makie</code> and build the plot “manually” by extracting the time <code>t</code> and dependent variable values <code>u</code> from the solution object.</p>
<div class="cell page-columns page-full" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>sol <span class="op">=</span> <span class="fu">solve</span>(prob)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>diff_plt <span class="op">=</span> <span class="fu">lines!</span>(ax, sol.t,<span class="fu">vcat</span>(sol.u<span class="op">...</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Legend</span>(fig[<span class="fl">1</span>, <span class="fl">2</span>],</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    [rec_plt, rec_plt],</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    [L<span class="st">"n(t+1)"</span>, L<span class="st">"</span><span class="sc">\f</span><span class="st">rac{dn}{dt}"</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="no-row-height column-margin column-container"><div class="cell-output cell-output-display" data-execution_count="28">
<p><img src="otto_day_02_files/figure-html/cell-28-output-1.svg" class="img-fluid"></p>
</div></div></div>
</section>
<section id="differential-equations-from-symbolic-expressions" class="level3">
<h3 class="anchored" data-anchor-id="differential-equations-from-symbolic-expressions">Differential Equations from Symbolic Expressions</h3>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ModelingToolkit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Anther approach to working with differential equation models in Julia is using <code>ModelingToolkit</code> which mixes symbolic and numeric computing by allowing the user to specify a high-level description of their model, which is then manipulated to produce optimised simulation code. Up till now we’ve just been referring to all symbols as <code>variables</code> but in order to work with ModellingToolkit we will need to be more precise in our terminology, separating variables from parameters and explicitly defining <span class="math inline">\(n\)</span> as a function of <span class="math inline">\(t\)</span>. We will also use the syntax <a href="https://docs.sciml.ai/Symbolics/stable/tutorials/symbolic_functions/#Derivatives-1"><code>D = Differential(t)</code></a> to set up derivatives(s) w.r.t <span class="math inline">\(t\)</span></p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@variables</span> t <span class="fu">n</span>(t)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@parameters</span> b d m Δt</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> <span class="fu">Differential</span>(t)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we use identical code to that above, to get to <code>diff_eq</code></p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>n′ <span class="op">=</span> <span class="fu">n*</span>(<span class="fl">1</span><span class="op">+</span>b<span class="op">*</span>Δt)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>n′′ <span class="op">=</span> <span class="fu">n′*</span>(<span class="fl">1</span><span class="op">-</span>d<span class="op">*</span>Δt)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>n′′′ <span class="op">=</span> n′′<span class="op">+</span>m<span class="op">*</span>Δt</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>eq <span class="op">=</span> (n′′′ <span class="op">-</span> n)<span class="op">/</span>Δt</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>simp_eq <span class="op">=</span> <span class="fu">simplify</span>(eq)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>diff_eq <span class="op">=</span> <span class="fu">substitute</span>(simp_eq, Δt <span class="op">=&gt;</span> <span class="fl">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<p><span class="math display">\[ \begin{equation}
m + b n\left( t \right) - d n\left( t \right)
\end{equation}
\]</span></p>
</div>
</div>
<p>The nice thing here, is that even though we use <code>n</code> not <code>n(t)</code> in our code, <code>Symbolics</code> remembers that <span class="math inline">\(n\)</span> is a function of <span class="math inline">\(t\)</span>.</p>
<p>Remember <code>D = Differential(t)</code>, thus we can use <code>D(n)</code> when setting up a differential equation for the dependent variable <span class="math inline">\(n\)</span> w.r.t. the independent variable <span class="math inline">\(t\)</span>.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@named</span> mice_mtk <span class="op">=</span> <span class="fu">ODESystem</span>(<span class="fu">D</span>(n) <span class="op">~</span> diff_eq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<p><span class="math display">\[ \begin{align}
\frac{\mathrm{d} n\left( t \right)}{\mathrm{d}t} =&amp; m + b n\left( t \right) - d n\left( t \right)
\end{align}
\]</span></p>
</div>
</div>
<p>Note the name <code>ODESystem</code>. Here we have a single differential equation, but we could equally have supplied a vector of equations. Likewise, we could have written the equation explicitly <code>D(n) ~ m + b*n - d*n</code>. Another difference between the <code>ModelingToolkit</code> and <code>DifferentialEquations</code> workflow is that we will now be specifying parameter values and initial values for variables as vectors of <code>Pair</code>s where each symbol is assigned a numerical value.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>u₀ <span class="op">=</span> [n <span class="op">=&gt;</span> <span class="fl">0.0</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>t_span <span class="op">=</span> (<span class="fl">0.0</span>,<span class="fl">100.0</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [b <span class="op">=&gt;</span> <span class="fl">0.4</span>, d <span class="op">=&gt;</span> <span class="fl">0.5</span>, m  <span class="op">=&gt;</span> <span class="fl">1.5</span>]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>prob_mtk <span class="op">=</span> <span class="fu">ODEProblem</span>(mice_mtk, u₀, t_span, P)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div class="ansi-escaped-output">
<pre><span class="ansi-cyan-fg">ODEProblem</span> with uType <span class="ansi-cyan-fg">Vector{Float64}</span> and tType <span class="ansi-cyan-fg">Float64</span>. In-place: <span class="ansi-cyan-fg">true</span>
timespan: (0.0, 100.0)
u0: 1-element Vector{Float64}:
 0.0</pre>
</div>
</div>
</div>
<p>As a final note, the <code>ModelingToolkit</code> version is a bit faster…</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">solve</span>(prob);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  66.400 μs (976 allocations: 31.92 KiB)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@btime</span> <span class="fu">solve</span>(prob_mtk);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  36.400 μs (273 allocations: 25.28 KiB)</code></pre>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>